<div class="filter-container">
  <div class="flex flex-wrap gap-4 items-center">

    <!-- Filtro por Empresa -->
    <div class="relative">
      <button
        type="button"
        class="filter-button flex items-center gap-2 px-3 py-2 rounded-md transition-colors text-sm"
        (click)="showEmpresasDropdown = !showEmpresasDropdown">
        <i class="fa-solid fa-building text-gray-500"></i>
        <span class="font-medium">{{ getSelectedEmpresaName() }}</span>
        <i class="fa-solid fa-chevron-down text-xs text-gray-400"></i>
      </button>

      <!-- Dropdown de Empresas -->
      <div *ngIf="showEmpresasDropdown"
           class="absolute top-full left-0 mt-1 w-64 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
        <div class="p-2">
          <div class="px-3 py-2 text-sm text-gray-500 border-b">Seleccionar Empresa</div>
          <button
            class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100 rounded"
            [class.bg-blue-100]="!currentFilter.empresaId"
            (click)="onEmpresaChange(null); showEmpresasDropdown = false">
            Todas las empresas
          </button>
          <button
            *ngFor="let empresa of empresas"
            class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100 rounded"
            [class.bg-blue-100]="currentFilter.empresaId === empresa.id"
            (click)="onEmpresaChange(empresa.id); showEmpresasDropdown = false">
            {{ empresa.nombre }}
          </button>
        </div>
      </div>
    </div>

    <!-- Filtro por Colaboradores -->
    <div class="relative">
      <button
        type="button"
        class="filter-button flex items-center gap-2 px-3 py-2 rounded-md transition-colors text-sm"
        (click)="showColaboradoresDropdown = !showColaboradoresDropdown">
        <i class="fa-solid fa-users text-gray-500"></i>
        <span class="font-medium">{{ getSelectedColaboradoresNames() }}</span>
        <i class="fa-solid fa-chevron-down text-xs text-gray-400"></i>
      </button>

      <!-- Dropdown de Colaboradores -->
      <div *ngIf="showColaboradoresDropdown"
           class="absolute top-full left-0 mt-1 w-80 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
        <div class="p-2">
          <!-- Barra de búsqueda -->
          <div class="px-3 py-2 border-b">
            <input
              type="text"
              [(ngModel)]="currentFilter.searchTerm"
              (input)="onSearchChange()"
              placeholder="Buscar colaboradores..."
              class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>

          <!-- Lista de colaboradores -->
          <div class="max-h-60 overflow-y-auto">
            <div class="px-3 py-2 text-sm text-gray-500 border-b">Colaboradores Habilitados</div>
            <button
              class="w-full text-left px-3 py-2 text-sm hover:bg-gray-100 rounded flex items-center gap-2"
              [class.bg-blue-100]="currentFilter.colaboradorIds.length === 0"
              (click)="currentFilter.colaboradorIds = []; emitFilterChange()">
              <i class="fa-solid fa-check text-xs" [class.invisible]="currentFilter.colaboradorIds.length > 0"></i>
              Todos los colaboradores
            </button>

            <div *ngFor="let colaborador of filteredColaboradores"
                 class="px-3 py-2 hover:bg-gray-100 rounded flex items-center gap-2">
              <input
                type="checkbox"
                [checked]="isColaboradorSelected(colaborador.id!)"
                (change)="onColaboradorToggle(colaborador.id!)"
                class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
              <div class="flex-1 min-w-0">
                <div class="text-sm font-medium text-gray-900 truncate">
                  {{ colaborador.nombre }} {{ colaborador.apellido }}
                </div>
                <div class="text-xs text-gray-500 truncate">
                  {{ colaborador.empresaNombre }}
                </div>
              </div>
            </div>

            <div *ngIf="filteredColaboradores.length === 0"
                 class="px-3 py-4 text-sm text-gray-500 text-center">
              No se encontraron colaboradores
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botón Limpiar Filtros -->
    <button
      type="button"
      class="flex items-center gap-2 px-3 py-2 text-sm text-gray-500 hover:text-gray-700 hover:bg-gray-50 rounded-md transition-colors"
      (click)="clearAllFilters()">
      <i class="fa-solid fa-times text-xs"></i>
      <span class="hidden sm:inline">Limpiar</span>
    </button>

    <!-- Indicador de filtros activos -->
    <div *ngIf="currentFilter.empresaId || currentFilter.colaboradorIds.length > 0"
         class="flex items-center gap-1 px-2 py-1 bg-blue-50 text-blue-600 rounded-md text-xs font-medium">
      <i class="fa-solid fa-filter text-xs"></i>
      <span class="hidden sm:inline">Activos</span>
    </div>
  </div>
</div>
